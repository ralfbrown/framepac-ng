/****************************** -*- C++ -*- *****************************/
/*									*/
/* FramepaC-ng								*/
/* Version 0.15, last edit 2019-07-29					*/
/*	by Ralf Brown <ralf@cs.cmu.edu>					*/
/*									*/
/* (c) Copyright 2019 Carnegie Mellon University			*/
/*	This program may be redistributed and/or modified under the	*/
/*	terms of the GNU General Public License, version 3, or an	*/
/*	alternative license agreement as detailed in the accompanying	*/
/*	file LICENSE.  You should also have received a copy of the	*/
/*	GPL (file COPYING) along with this program.  If not, see	*/
/*	http://www.gnu.org/licenses/					*/
/*									*/
/*	This program is distributed in the hope that it will be		*/
/*	useful, but WITHOUT ANY WARRANTY; without even the implied	*/
/*	warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR		*/
/*	PURPOSE.  See the GNU General Public License for more details.	*/
/*									*/
/************************************************************************/

#include <cstdint>
#include "framepac/romanize.h"
#include "framepac/unicode.h"

namespace Fr
{

/************************************************************************/
/*	Types local to this module					*/
/************************************************************************/

struct ISO9Element
   {
      uint16_t codepoint1, codepoint2 ;
   } ;

/************************************************************************/
/************************************************************************/

#ifndef lengthof
#  define lengthof(x) (sizeof(x)/sizeof((x)[0]))
#endif /* lengthof */

/************************************************************************/
/*	Global data for this module					*/
/************************************************************************/

#define ISO843_TABLE_START    0x037C		// Greek
#define ISO9_TABLE_START      0x0400		// Cyrillic
#define ISO9985_TABLE_START   0x0530		// Armenian
#define	ISO295_TABLE_START    0x05B0		// Hebrew
#define ISO233_TABLE_START    0x0600		// Arabic
#define ISO15919_TABLE_START  0x0900		// Devanagari
#define ISO11940_TABLE_START  0x0E00		// Thai
#define ISO9984_TABLE_START   0x10D0		// Georgian
#define ISO843EXT_TABLE_START 0x1F00		// extended Greek

// romanization information for Greek character codepoints
static const ISO9Element primary_table[] =
   {
   // romanization table for Hebrew
      { 0, 0 }, { 'e', 0 }, { 'a', 0 }, { 'o', 0 },			// 0x05B0-0x05B3
      { 'i', 0 }, { 'e', 0 }, { 'e', 0 }, { 'a', 0 },			// 0x05B4-0x05B7
      { 'a', 0 }, { 0, 0 }, { 0, 0 }, { 'u', 0 },			// 0x05B8-0x05BB
      { 'u', 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x05BC-0x05BF
      { 0, 0 }, { 0, 0 }, { 'o', 0 }, { 0, 0 },				// 0x05C0-0x05C3
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x05C4-0x05C7
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x05C8-0x05CB
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x05CC-0x05CF
      { 0x02C0, 0 }, { 'b', 0 }, { 'g', 0 }, { 'd', 0 },		// 0x05D0-0x05D3
      { 'h', 0 }, { 'w', 0 }, { 'z', 0 }, { 0x1E25, 0 },		// 0x05D4-0x05D7
      { 0x1E6F, 0 }, { 'y', 0 }, { 'k', 0 }, { 'k', 0 },		// 0x05D8-0x05DB
      { 'l', 0 }, { 'm', 0 }, { 'm', 0 }, { 'n', 0 },			// 0x05DC-0x05DF
      { 'n', 0 }, { 's', 0 }, { 0x02C1, 0 }, { 'p', 0 },		// 0x05E0-0x05E3
      { 'p', 0 }, { 'c', 0 }, { 'c', 0 }, { 'q', 0 },			// 0x05E4-0x05E7
      { 'r', 0 }, { 0x0161, 0 }, { 't', 0 }, { 0, 0 },			// 0x05E8-0x05EB
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x05EC-0x05EF
   // romanization table for Arabic
      { 0, 0 }, { 0x02CC, 0 }, { '\'', 'A' }, { '>', 0 },		// 0x0620-0x0623
      { '&', 0 }, { '<', 0 }, { '}', 0 }, { 'A', 0 },			// 0x0624-0x0627
      { 'b', 0 }, { 0x1E97, 0 }, { 't', 0 }, { 0x1E6F, 0 },		// 0x0628-0x062B
      { 0x01E7, 0 }, { 0x1E25, 0 }, { 0x1E96, 0 }, { 'd', 0 },		// 0x062C-0x062F
      { 0x1E0F, 0 }, { 'r', 0 }, { 'z', 0 }, { 's', 0 },		// 0x0630-0x0633
      { 0x0161, 0 }, { 0x1E63, 0 }, { 0x1E0D, 0 }, { 0x1E6D, 0 },	// 0x0634-0x0637
      { 0x1E93, 0 }, { 0x02BF, 0 }, { 0x0121, 0 }, { 0, 0 },		// 0x0638-0x063B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },				// 0x063C-0x063F
      { '_', 0 }, { 'f', 0 }, { 'q', 0 }, { 'k', 0 },			// 0x0640-0x0643
      { 'l', 0 }, { 'm', 0 }, { 'n', 0 }, { 'h', 0 },			// 0x0644-0x0647
      { 'w', 0 }, { 0x1EF3, 0 }, { 'y', 0 }, { 'F', 0 },		// 0x0648-0x064B
      { 'N', 0 }, { 'K', 0 }, { 'a', 0 }, { 'u', 0 },			// 0x064C-0x064F
      { 'i', 0 }, { '~', 0 }, { 'o', 0 }, { '^', 0 },			// 0x0650-0x0653
      { 0x02C8, 0 }, { '\'', 0 }, { 0, 0 }, { 0, 0 },			// 0x0654-0x0657
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0658-0x065B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x065C-0x065F
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0660-0x0663
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0664-0x0667
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0668-0x066B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x066C-0x066F
      { '`', 0 }, { '{', 0 }, { 0, 0 }, { 0, 0 },		// 0x0670-0x0673
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0674-0x0677
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0678-0x067B
      { 0, 0 }, { 0, 0 }, { 'P', 0 }, { 0, 0 },		// 0x067C-0x067F
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0680-0x0683
      { 0, 0 }, { 0, 0 }, { 'J', 0 }, { 0, 0 },		// 0x0684-0x0687
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0688-0x068B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x068C-0x068F
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0690-0x0693
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0694-0x0697
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x0698-0x069B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },		// 0x069C-0x069F
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x06A0-0x06A3
      { 'V', 0 },   { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x06A4-0x06A7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x06A8-0x06AB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 'G', 0 },		// 0x06AC-0x06AF
   // romanization table for Syriac
      { '\'', 0 },  { 0, 0 },     { 'b', 0 },   { 'g', 0 },		// 0x0710-0x0713
      { 'g', 0 },   { 'd', 0 },   { 'd', 0 },   { 'h', 0 },		// 0x0714-0x0717
      { 'w', 0 },   { 'z', 0 },   { 0x1E25,0 }, { 0x1E6D,0 },		// 0x0718-0x071B
      { 0x1E6D,0 }, { 'y', 0 },   { 'y', 0 },   { 'k', 0 },		// 0x071C-0x071F
      { 'l', 0 },   { 'm', 0 },   { 'n', 0 },   { 's', 0 },		// 0x0720-0x0723
      { 's', 0 },   { 'e', 0 },   { 'p', 0 },   { 'p', 0 },		// 0x0724-0x0727
      { 0x1E63,0 }, { 'q', 0 },   { 'r', 0 },   { 0x0161,0 },		// 0x0728-0x072B
      { 't', 0 },   { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x072C-0x072F
   // end of Syriac
   // romanization data for NKo / Mande
      { '0', 0 },   { '1', 0 },   { '2', 0 },   { '3', 0 },		// 0x07C0-0x07C3
      { '4', 0 },   { '5', 0 },   { '6', 0 },   { '7', 0 },		// 0x07C4-0x07C7
      { '8', 0 },   { '9', 0 },   { 'a', 0 },   { 'e', 0 },		// 0x07C8-0x07CB
      { 'i', 0 },   { 0x025B,0 }, { 'u', 0 },   { 'o', 0 },		// 0x07CC-0x07CF
      { 0x0254,0 }, { 0, 0 },     { 'n', 0 },   { 'b', 0 },		// 0x07D0-0x07D3
      { 'p', 0 },   { 't', 0 },   { 'j', 0 },   { 'c', 0 },		// 0x07D4-0x07D7
      { 'd', 0 },   { 'r', 0 },   { 'r', 'r' }, { 's', 0 },		// 0x07D8-0x07DB
      { 'g', 'b' }, { 'f', 0 },   { 'k', 0 },   { 'l', 0 },		// 0x07DC-0x07DF
      { 'n', 0 },   { 'm', 0 },   { 0x0272,0 }, { 'n', 0 },		// 0x07E0-0x07E3
      { 'h', 0 },   { 'w', 0 },   { 'y', 0 },   { 0x0272,0 },		// 0x07E4-0x07E7
   // begin Syriac supplement
      { 'n', 'g' }, { 'j', 0 },   { 'n', 'y' }, { 't', 'a' },		// 0x0860-0x0863
      { 'n', 'a' }, { 'n', 'a' }, { 'b', 'a' }, { 'r', 'a' },		// 0x0864-0x0867
      { 'l', 'a' }, { 'l', 'a' }, { 's', 'a' }, { 0, 0 },		// 0x0868-0x086B
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x086C-0x086F
   // romanization table for Devanagari (ISO 15919)
      { 0, 0 },     {'m',0x0310}, { 0x1E41,0 }, { 0x1E25,0 },		// 0x0900-0x0903
      { 0, 0 },     { 'a', 0 },   { 0x0101,0 }, { 'i', 0 },		// 0x0904-0x0907
      { 0x012B,0 }, { 'u', 0 },   { 0x016B,0 }, { 0x1E5B,0 },		// 0x0908-0x090B
      { 0x1E37,0 }, { 0x00EA,0 }, { 'e', 0 },   { 0x0113,0 },		// 0x090C-0x090F
      { 'a', 'i' }, { 0x00F4,0 }, { 'o', 0 },   { 0x014D,0 },		// 0x0910-0x0913
      { 'a', 'u' }, { 'k', 'a' }, { 'k', 'h' }, { 'g', 'a' },		// 0x0914-0x0917
      { 'g', 'h' }, {0x1E45,'a'}, { 'c', 'a' }, { 'c', 'h' },		// 0x0918-0x091B
      { 'j', 'a' }, { 'j', 'h' }, {0x00F1,'a'}, {0x1E6D,'a'},		// 0x091C-0x091F
      {0x1E6D,'h'}, {0x1E0D,'a'}, {0x1E0D,'h'}, {0x1E47,'a'},		// 0x0920-0x0923
      { 't', 'a' }, { 't', 'h' }, { 'd', 'a' }, { 'd', 'h' },		// 0x0924-0x0927
      { 'n', 'a' }, {'n',0x0331}, { 'p', 'a' }, { 'p', 'h' },		// 0x0928-0x092B
      { 'b', 'a' }, { 'b', 'h' }, { 'm', 'a' }, { 'y', 'a' },		// 0x092C-0x092F
      { 'r', 'a' }, {'r',0x0331}, { 'l', 'a' }, {0x1E37,'a'},		// 0x0930-0x0933
      {'l',0x0331}, { 'v', 'a' }, {0x015B,'a'}, {0x1E63,'a'},		// 0x0934-0x0937
      { 's', 'a' }, { 'h', 'a' }, { 0, 0 },     { 0, 0 },		// 0x0938-0x093B
      { 0, 0 },     { '\'', 0 },  { 0x0101,0 }, { 'i', 0 },		// 0x093C-0x093F
      { 0x012B,0 }, { 'u', 0 },   { 0x016B,0 }, { 0x1E5B,0 },		// 0x0940-0x0943
      { 0x1E5D,0 }, { 0x00EA,0 }, { 'e', 0 },   { 0x0113,0 },		// 0x0944-0x0947
      { 'a', 'i' }, { 0x00F4,0 }, { 'o', 0 },   { 0x014D,0 },		// 0x0948-0x094B
      { 'a', 'u' }, { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x094C-0x094F
      {'o',0x1E43}, { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0950-0x0953
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0954-0x0957
      { 'q', 'a' }, { 'k', 'h' }, { 0x0121,0 }, { 'z', 'a' },		// 0x0958-0x095B
      {0x1E5B,'a'}, {0x1E5B,'h'}, { 'f', 'a' }, {0x1E8F,'a'},		// 0x095C-0x095F
      { 0x1E5D,0 }, { 0x1E39,0 }, { 0x1E37,0 }, { 0x1E39,0 },		// 0x0960-0x0963
      { '.', 0 },   { '.', '.' }, { '0', 0 },   { '1', 0 },		// 0x0964-0x0967
      { '2', 0 },   { '3', 0 },   { '4', 0 },   { '5', 0 },		// 0x0968-0x096B
      { '6', 0 },   { '7', 0 },   { '8', 0 },   { '9', 0 },		// 0x096C-0x096F
      { 0x2026,0 }, { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0970-0x0973
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0974-0x0977
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0978-0x097B
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x097C-0x097F
   // Bengali/Assamese       TODO
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0980-0x0983
      { 0, 0 },     { 'a', 0 },   { 0x0101,0 }, { 'i', 0 },		// 0x0984-0x0987
      { 0x012B,0 }, { 'u', 0 },   { 0x016B,0 }, { 0, 0 },		// 0x0988-0x098B
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x098C-0x098F
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0990-0x0993
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0994-0x0997
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x0998-0x099B
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x099C-0x099F
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09A0-0x09A3
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09A4-0x09A7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09A8-0x09AB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09AC-0x09AF
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09B0-0x09B3
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09B4-0x09B7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09B8-0x09BB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09BC-0x09BF
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09C0-0x09C3
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09C4-0x09C7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09C8-0x09CB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09CC-0x09CF
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09D0-0x09D3
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09D4-0x09D7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09D8-0x09DB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09DC-0x09DF
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09E0-0x09E3
      { 0, 0 },     { 0, 0 },     { '0', 0 },   { '1', 0 },		// 0x09E4-0x09E7
      { '2', 0 },   { '3', 0 },   { '4', 0 },   { '5', 0 },		// 0x09E8-0x09EB
      { '6', 0 },   { '7', 0 },   { '8', 0 },   { '9', 0 },		// 0x09EC-0x09EF
      { 'r', 'a' }, { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09F0-0x09F3
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09F4-0x09F7
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09F8-0x09FB
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x09FC-0x09FF
   // romanization table for Thai (ISO 11940)
      { 0, 0 }, { 'k', 0 }, { 'k', 'h' }, { 0x1E33, 'h' },	// 0x0E00-0x0E03
      { 'k', 'h' }, { 'k', 'h' }, { 0x1E33, 'h' }, { 'n', 'g' }, // 0x0E04-0x0E07
      { 'c', 0 }, { 'c', 'h' }, { 'c', 'h' }, { 's', 0 },	// 0x0E08-0x0E0B
      { 'c', 'h' }, { 'y', 0 }, { 0x1E0D, 0 }, { 0x1E6D, 0 },	// 0x0E0C-0x0E0F
      { 0x1E6D, 'h' }, { 0x1E6F, 'h' }, { 't', 'h' }, { 0x1E47, 0 }, // 0x0E10-0x0E13
      { 'd', 0 }, { 't', 0 }, { 't', 'h' }, { 't', 'h' },	// 0x0E14-0x0E17
      { 0x1E6D, 'h' }, { 'n', 0 }, { 'b', 0 }, { 'p', 0 },	// 0x0E18-0x0E1B
      { 'p', 'h' }, { 'f', 0 }, { 'p', 'h' }, { 'f', 0 },	// 0x0E1C-0x0E1F
      { 'p', 'h' }, { 'm', 0 }, { 'y', 0 }, { 'r', 0 },		// 0x0E20-0x0E23
      { 'v', 0 }, { 'l', 0 }, { 0x0142, 0 }, { 'w', 0 },	// 0x0E24-0x0E27
      { 0x1E63, 0 }, { 's', 0 }, { 's', 0 }, { 'h', 0 },	// 0x0E28-0x0E2B
      { 0x1E37, 0 }, { 'x', 0 }, { 0x1E25, 0 }, { 0x01C2, 0 },	// 0x0E2C-0x0E2F
      { 'a', 0 }, { 0x1EA1, 0 }, { 0x0101, 0 }, { 0x00E5, 0 },	// 0x0E30-0x0E33
      { 'i', 0 }, { 0x012B, 0 }, { 0x1EE5, 0 }, { 0x1EE5, 0 },	// 0x0E34-0x0E37
      { 'u', 0 }, { 0x016B, 0 }, { 0, 0 }, { 0, 0 },		// 0x0E38-0x0E3B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },			// 0x0E3C-0x0E3F
      { 'e', 0 }, { 0x00E6, 0 }, { 'o', 0 }, { 0x0131, 0 },	// 0x0E40-0x0E43
      { 0x1ECB, 0 }, { 0x0268, 0 }, { 0x00AB, 0 }, { 0, 0 },	// 0x0E44-0x0E47
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },			// 0x0E48-0x0E4B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0x00A7, 0 },		// 0x0E4C-0x0E4F
      { '0', 0 }, { '1', 0 }, { '2', 0 }, { '3', 0 },		// 0x0E50-0x0E53
      { '4', 0 }, { '5', 0 }, { '6', 0 }, { '7', 0 },		// 0x0E54-0x0E57
      { '8', 0 }, { '9', 0 }, { 0x01C1, 0 }, { 0x00BB, 0 },	// 0x0E58-0x0E5B
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },			// 0x0E5C-0x0E5F
   // romanization information for Georgian (ISO 9984)
      { 'a', 0 },   { 'b', 0 },   { 'g', 0 },   { 'd', 0 },		// 0x10D0-0x10D3
      { 'e', 0 },   { 'v', 0 },   { 'z', 0 },   { 't', '\'' },		// 0x10D4-0x10D7
      { 'i', 0 },   { 'k', 0 },   { 'l', 0 },   { 'm', 0 },		// 0x10D8-0x10DB
      { 'n', 0 },   { 'o', 0 },   { 'p', 0 },   { 0x017E,0 },		// 0x10DC-0x10DF
      { 'r', 0 },   { 's', 0 },   { 't', 0 },   { 'u', 0 },		// 0x10E0-0x10E3
      { 'p','\'' }, { 'k','\'' }, { 0x1E21,0 }, { 'q', 0 },		// 0x10E4-0x10E7
      { 0x0161,0 }, {0x010D,'\''},{ 'c','\'' }, { 'j', 0 }, 		// 0x10E8-0x10EB
      { 'c', 0 },   { 0x010D,0 }, { 'x', 0 },   { 0x01F0,0 },		// 0x10EC-0x10EF
      { 'h', 0 },   { 0x0113,0 }, { 'y', 0 },   { 'w', 0 },		// 0x10F0-0x10F3
      { 0x1E96,0 }, { 0x014D,0 }, { 'f', 0 },   { 0, 0 },		// 0x10F4-0x10F7
   // romanization information for Ethiopic (Amharic)
      { 'h', 'a' }, { 'h', 'u' }, { 'h', 'i' }, {'h',0x0101},	// 0x1200-0x1203
      { 'h',0xE9 }, { 'h', 'e' }, { 'h', 'o' }, { 'h', 'o' },   // 0x1204-0x1207
      { 'l', 'a' }, { 'l', 'u' }, { 'l', 'i' }, { 'l', 'a' },	// 0x1208-0x120B
      { 'l', 'e' }, { 'l', 'e' }, { 'l', 'o' }, { 'l', 'a' },	// 0x120C-0x120F
      //TODO
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 }, 	// 0x1210-0x1213
      { 0, 0 },     { '1', 0 },   { '2', 0 },   { '3', 0 },	// 0x1368-0x136B
      { '4', 0 },   { '5', 0 },   { '6', 0 },   { '7', 0 },	// 0x136C-0x136F
      { '8', 0 },   { '9', 0 },   { '1', '0' }, { '2', '0' },	// 0x1370-0x1373
      { '3', '0' }, { '4', '0' }, { '5', '0' }, { '6', '0' },	// 0x1374-0x1377
      { '7', '0' }, { '8', '0' }, { '9', '0' }, { '1', '0' },	// 0x1377-0x137B
      { '1', '0' }, { 0, 0 },     { 0, 0 },     { 0, 0 },	// 0x137C-0x137F
   // Cherokee
      { 'a', 0 },   { 'e', 0 },   { 'i', 0 },   { 'o', 0 }, 	// 0x13A0-0x13A3
      { 'u', 0 },   { 'v', 0 },   { 'g', 'a' }, { 'k', 'a' }, 	// 0x13A4-0x13A7
      { 'g', 'e' }, { 'g', 'i' }, { 'g', 'o' }, { 'g', 'u' }, 	// 0x13A8-0x13AB
      { 'g', 'v' }, { 'h', 'a' }, { 'h', 'e' }, { 'h', 'i' }, 	// 0x13AC-0x13AF
      { 'h', 'o' }, { 'h', 'u' }, { 'h', 'v' }, { 'l', 'a' }, 	// 0x13B0-0x13B3
      { 'l', 'e' }, { 'l', 'i' }, { 'l', 'o' }, { 'l', 'u' }, 	// 0x13B4-0x13B7
      { 'l', 'v' }, { 'm', 'a' }, { 'm', 'e' }, { 'm', 'i' }, 	// 0x13B8-0x13BB
      { 'm', 'o' }, { 'm', 'u' }, { 'n', 'a' }, { 'n', 'a' }, 	// 0x13BC-0x13BF
      { 'n', 'a' }, { 'n', 'e' }, { 'n', 'i' }, { 'n', 'o' }, 	// 0x13C0-0x13C3
      { 'n', 'u' }, { 'n', 'v' }, { 'q', 'a' }, { 'q', 'e' }, 	// 0x13C4-0x13C7
      { 'q', 'i' }, { 'q', 'o' }, { 'q', 'u' }, { 'q', 'v' }, 	// 0x13C8-0x13CB
      { 's', 'a' }, { 's', 0 },   { 's', 'e' }, { 's', 'i' }, 	// 0x13CC-0x13CF
      { 's', 'o' }, { 's', 'u' }, { 's', 'v' }, { 'd', 'a' }, 	// 0x13D0-0x13D3
      { 't', 'a' }, { 'd', 'e' }, { 't', 'e' }, { 'd', 'i' }, 	// 0x13D4-0x13D7
      { 't', 'i' }, { 'd', 'o' }, { 'd', 'u' }, { 'd', 'v' }, 	// 0x13D8-0x13DB
      { 'd', 'l' }, { 't', 'l' }, { 't', 'l' }, { 't', 'l' }, 	// 0x13DC-0x13DF
      { 't', 'l' }, { 't', 'l' }, { 't', 'l' }, { 't', 's' }, 	// 0x13E0-0x13E3
      { 't', 's' }, { 't', 's' }, { 't', 's' }, { 't', 's' }, 	// 0x13E4-0x13E7
      { 't', 's' }, { 'w', 'a' }, { 'w', 'e' }, { 'w', 'i' }, 	// 0x13E8-0x13EB
      { 'w', 'o' }, { 'w', 'u' }, { 'w', 'v' }, { 'y', 'a' }, 	// 0x13EC-0x13EF
      { 'y', 'e' }, { 'y', 'i' }, { 'y', 'o' }, { 'y', 'u' }, 	// 0x13F0-0x13F3
      { 'y', 'v' }, { 'm', 'v' }, { 0, 0 },     { 0, 0 }, 	// 0x13F4-0x13F7
      { 'y', 'e' }, { 'y', 'i' }, { 'y', 'o' }, { 'y', 'u' }, 	// 0x13F8-0x13FB
      { 'y', 'v' }, { 'm', 'v' }, { 0, 0 },     { 0, 0 }, 	// 0x13FC-0x13FF
   // begin Ol Chiki
      { '0', 0 },   { '1', 0 },   { '2', 0 },   { '3', 0 },		// 0x1C50-0x1C53
      { '4', 0 },   { '5', 0 },   { '6', 0 },   { '7', 0 },		// 0x1C54-0x1C57
      { '8', 0 },   { '9', 0 },   { 0, 0 },     { 0, 0 },		// 0x1C58-0x1C5B
   //TODO
      { 0, 0 },     { 0, 0 },     { 0, 0 },     { 0, 0 },		// 0x1C5C-0x1C5F
   // romanization information for extended Greek characters
   //    (treated like ISO 843 after ignoring diacritics)
      { 'a', 0 }, { 'a', 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1F00-0x1F03
      { 'a', 0 }, { 'a', 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1F04-0x1F07
      { 'A', 0 }, { 'A', 0 }, { 'A', 0 }, { 'A', 0 },		// 0x1F08-0x1F0B
      { 'A', 0 }, { 'A', 0 }, { 'A', 0 }, { 'A', 0 },		// 0x1F0C-0x1F0F
      { 'e', 0 }, { 'e', 0 }, { 'e', 0 }, { 'e', 0 },		// 0x1F10-0x1F13
      { 'e', 0 }, { 'e', 0 }, { 0, 0 }, { 0, 0 },		// 0x1F14-0x1F17
      { 'E', 0 }, { 'E', 0 }, { 'E', 0 }, { 'E', 0 },		// 0x1F18-0x1F1B
      { 'E', 0 }, { 'E', 0 }, { 0, 0 }, { 0, 0 },		// 0x1F1C-0x1F1F
      { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, // 0x1F20-0x1F23
      { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, // 0x1F24-0x1F27
      { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, // 0x1F28-0x1F2B
      { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, // 0x1F2C-0x1F2F
      { 'i', 0 }, { 'i', 0 }, { 'i', 0 }, { 'i', 0 },		// 0x1F30-0x1F33
      { 'i', 0 }, { 'i', 0 }, { 'i', 0 }, { 'i', 0 },		// 0x1F34-0x1F37
      { 'I', 0 }, { 'I', 0 }, { 'I', 0 }, { 'I', 0 },		// 0x1F38-0x1F3B
      { 'I', 0 }, { 'I', 0 }, { 'I', 0 }, { 'I', 0 },		// 0x1F3C-0x1F3F
      { 'o', 0 }, { 'o', 0 }, { 'o', 0 }, { 'o', 0 },		// 0x1F40-0x1F43
      { 'o', 0 }, { 'o', 0 }, { 0, 0 }, { 0, 0 },		// 0x1F44-0x1F47
      { 'O', 0 }, { 'O', 0 }, { 'O', 0 }, { 'O', 0 },		// 0x1F48-0x1F4B
      { 'O', 0 }, { 'O', 0 }, { 0, 0 }, { 0, 0 },		// 0x1F4C-0x1F4F
      { 'u', 0 }, { 'u', 0 }, { 'u', 0 }, { 'u', 0 },		// 0x1F50-0x1F53
      { 'u', 0 }, { 'u', 0 }, { 'u', 0 }, { 'u', 0 },		// 0x1F54-0x1F57
      { 0, 0 }, { 'U', 0 }, { 0, 0 }, { 'U', 0 },		// 0x1F58-0x1F5B
      { 0, 0 }, { 'U', 0 }, { 0, 0 }, { 'U', 0 },		// 0x1F5C-0x1F5F
      { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 },		// 0x1F60-0x1F63
      { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 },		// 0x1F64-0x1F67
      { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 },		// 0x1F68-0x1F6B
      { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 },		// 0x1F6C-0x1F6F
      { 'a', 0 }, { 'a', 0 }, { 'e', 0 }, { 'e', 0 },		// 0x1F70-0x1F73
      { 0x012B, 0 }, { 0x012B, 0 }, { 'i', 0 }, { 'i', 0 },		// 0x1F74-0x1F77
      { 'o', 0 }, { 'o', 0 }, { 'u', 0 }, { 'u', 0 },		// 0x1F78-0x1F7B
      { 0x014D, 0 }, { 0x014D, 0 }, { 0, 0 }, { 0, 0 },		// 0x1F7C-0x1F7F
      { 'a', 0 }, { 'a', 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1F80-0x1F83
      { 'a', 0 }, { 'a', 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1F84-0x1F87
      { 'A', 0 }, { 'A', 0 }, { 'A', 0 }, { 'A', 0 },		// 0x1F88-0x1F8B
      { 'A', 0 }, { 'A', 0 }, { 'A', 0 }, { 'A', 0 },		// 0x1F8C-0x1F8F
      { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, // 0x1F90-0x1F93
      { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, { 0x012B, 0 }, // 0x1F94-0x1F97
      { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, // 0x1F98-0x1F9B
      { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, { 0x012A, 0 }, // 0x1F9C-0x1F9F
      { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, // 0x1FA0-0x1FA3
      { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, { 0x014D, 0 }, // 0x1FA4-0x1FA7
      { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, // 0x1FA8-0x1FAB
      { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, { 0x014C, 0 }, // 0x1FAC-0x1FAF
      { 'a', 0 }, { 'a', 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1FB0-0x1FB3
      { 'a', 0 }, { 0, 0 }, { 'a', 0 }, { 'a', 0 },		// 0x1FB4-0x1FB7
      { 'A', 0 }, { 'A', 0 }, { 'A', 0 }, { 'A', 0 },		// 0x1FB8-0x1FBB
      { 'A', 0 }, { '\'', 0 }, { 0, 0 }, { '\'', 0 },		// 0x1FBC-0x1FBF
      { '~', 0 }, { 0, 0 }, { 0x012B, 0 }, { 0x012B, 0 },	// 0x1FC0-0x1FC3
      { 0x012B, 0 }, { 0, 0 }, { 0x012B, 0 }, { 0x012B, 0 },	// 0x1FC4-0x1FC7
      { 'E', 0 }, { 'E', 0 }, { 0x012A, 0 }, { 0x012A, 0 },	// 0x1FC8-0x1FCB
      { 0x012A, 0 }, { '\'', '`' }, { 0, 0 }, { 0, 0 },		// 0x1FCC-0x1FCF
      { 'i', 0 }, { 'i', 0 }, { 'i', 0 }, { 'i', 0 },		// 0x1FD0-0x1FD3
      { 0, 0 }, { 0, 0 }, { 'i', 0 }, { 'i', 0 },		// 0x1FD4-0x1FD7
      { 'I', 0 }, { 'I', 0 }, { 'I', 0 }, { 'I', 0 },		// 0x1FD8-0x1FDB
      { 0, 0 }, { 0, 0 }, { 0, 0 }, { 0, 0 },			// 0x1FDC-0x1FDF
      { 'u', 0 }, { 'u', 0 }, { 'u', 0 }, { 'u', 0 },		// 0x1FE0-0x1FE3
      { 'r', 0 }, { 'r', 0 }, { 'u', 0 }, { 'u', 0 },		// 0x1FE4-0x1FE7
      { 'U', 0 }, { 'U', 0 }, { 'U', 0 }, { 'U', 0 },		// 0x1FE8-0x1FEB
      { 'R', 0 }, { 0, 0 }, { 0, 0 }, { '`', 0 },		// 0x1FEC-0x1FEF
      { 0, 0 }, { 0, 0 }, { 0x014D, 0 }, { 0x014D, 0 },		// 0x1FF0-0x1FF3
      { 0x014D, 0 }, { 0, 0 }, { 0x014D, 0 }, { 0x014D, 0 },	// 0x1FF4-0x1FF7
      { 'O', 0 }, { 'O', 0 }, { 0x014C, 0 }, { 0x014C, 0 },	// 0x1FF8-0x1FFB
      { 0x014C, 0 }, { '\'', 0 }, { '`', 0 }, { 0, 0 },		// 0x1FFC-0x1FFF
   } ;

static uint16_t cp_table[] =
   {
   // Greek
   0x037E, '?', 0,
   0x0384, 0x00B4, 0,
   0x0386, 0x00C1, 0,
   0x0387, 0x00B7, 0,
   0x0388, 0x00C9, 0,
   0x0389, 0x012A, 0x0301, 0,
   0x038A, 0x00CD, 0,
   0x038C, 0x00D3, 0,
   0x038E, 0x00DD, 0,
   0x038F, 0x1E52, 0,
   0x0390, 0x1E2F, 0,
   0x0391, 'A', 0,
   0x0392, 'V', 0,
   0x0393, 'G', 0,
   0x0394, 'D', 0,
   0x0395, 'E', 0,
   0x0396, 'Z', 0,
   0x0397, 0x012A, 0,
   0x0398, 'T', 'h', 0,
   0x0399, 'I', 0,
   0x039A, 'K', 0,
   0x039B, 'L', 0,
   0x039C, 'M', 0,
   0x039D, 'N', 0,
   0x039E, 'X', 0,
   0x039F, 'O', 0,
   0x03A0, 'P', 0,
   0x03A1, 'R', 0,
   0x03A3, 'S', 0,
   0x03A4, 'T', 0,
   0x03A5, 'Y', 0,
   0x03A6, 'F', 0,
   0x03A7, 'C', 'h',
   0x03A8, 'P', 's', 0,
   0x03A9, 0x014C, 0,
   0x03AA, 0x00CF, 0,
   0x03AB, 0x0178, 0,
   0x03AC, 0x00E1, 0,
   0x03AD, 0x00E9, 0,
   0x03AE, 0x012B, 0x0301, 0,
   0x03AF, 0x00ED, 0,
   0x03B0, 0x00FF, 0x0301, 0,
   0x03B1, 'a', 0,
   0x03B2, 'v', 0,
   0x03B3, 'g', 0,
   0x03B4, 'd', 0,
   0x03B5, 'e', 0,
   0x03B6, 'z', 0,
   0x03B7, 0x012B, 0,
   0x03B8, 't', 'h', 0,
   0x03B9, 'i', 0,
   0x03BA, 'k', 0,
   0x03BB, 'l', 0,
   0x03BC, 'm', 0,
   0x03BD, 'n', 0,
   0x03BE, 'x', 0,
   0x03BF, 'o', 0,
   0x03C0, 'p', 0,
   0x03C1, 'r', 0,
   0x03C2, 's', 0,
   0x03C3, 's', 0,
   0x03C4, 't', 0,
   0x03C5, 'y', 0,
   0x03C6, 'f', 0,
   0x03C7, 'c', 'h', 0,
   0x03C8, 'p', 's', 0,
   0x03C9, 0x014D, 0,
   0x03CA, 0x00EF, 0,
   0x03CB, 0x00FF, 0,
   0x03CC, 0x00F3, 0,
   0x03CD, 0x00FD, 0,
   0x03CE, 0x1D53, 0,
   0x03D0, 'v', 0,
   0x03D1, 't', 'h', 0,
   0x03D2, 'Y', 0,
   0x03D3, 'Y', 0x0301, 0,
   0x03D4, 'Y', 0x0308, 0,
   0x03D5, 'f', 0,
   0x03D6, 'p', 0,
   0x03D7, '&', 0,
   // end Greek
   // Cyrillic
   0x0401, 0x00CB, 0,
   0x0402, 0x0110, 0,
   0x0403, 0x01F4, 0,
   0x0404, 0x00CA, 0,
   0x0405, 0x1E90, 0,
   0x0406, 0x00CC, 0,
   0x0407, 0x00CF, 0,
   0x0408, 'J', 0x030C, 0,
   0x0409, 'L', 0x0302, 0,
   0x040A, 'N', 0x0302, 0,
   0x040B, 0x0106, 0,
   0x040C, 0x1E30, 0,
   0x040E, 0x016C, 0,
   0x040F, 'D', 0x0302, 0,
   0x0410, 'A', 0,
   0x0411, 'B', 0,
   0x0412, 'V', 0,
   0x0413, 'G', 0,
   0x0414, 'D', 0,
   0x0415, 'E', 0,
   0x0416, 0x017D, 0,
   0x0417, 'Z', 0,
   0x0418, 'I', 0,
   0x0419, 'J', 0,
   0x041A, 'K', 0,
   0x041B, 'L', 0,
   0x041C, 'M', 0,
   0x041D, 'N', 0,
   0x041E, 'O', 0,
   0x041F, 'P', 0,
   0x0420, 'R', 0,
   0x0421, 'S', 0,
   0x0422, 'T', 0,
   0x0423, 'Y', 0,
   0x0424, 'F', 0,
   0x0425, 'H', 0,
   0x0426, 'C', 0,
   0x0427, 0x010C, 0,
   0x0428, 0x0160, 0,
   0x0429, 0x015C, 0,
   0x042A, 0x02BA, 0,
   0x042B, 'Y', 0,
   0x042C, 0x02B9, 0,
   0x042D, 0x00C8, 0,
   0x042E, 0x00DB, 0,
   0x042F, 0x00C2, 0,
   0x0430, 'a', 0,
   0x0431, 'b', 0,
   0x0432, 'v', 0,
   0x0433, 'g', 0,
   0x0434, 'd', 0,
   0x0435, 'e', 0,
   0x0436, 0x017E, 0,
   0x0437, 'z', 0,
   0x0438, 'i', 0,
   0x0439, 'j', 0,
   0x043A, 'k', 0,
   0x043B, 'l', 0,
   0x043C, 'm', 0,
   0x043D, 'n', 0,
   0x043E, 'o', 0,
   0x043F, 'p', 0,
   0x0440, 'r', 0,
   0x0441, 's', 0,
   0x0442, 't', 0,
   0x0443, 'u', 0,
   0x0444, 'f', 0,
   0x0445, 'h', 0,
   0x0446, 'c', 0,
   0x0447, 0x010D, 0,
   0x0448, 0x0161, 0,
   0x0449, 0x015D, 0,
   0x044A, 0x02BA, 0,
   0x044B, 'y', 0,
   0x044C, 0x02B9, 0,
   0x044D, 0x00E8, 0,
   0x044E, 0x00FB, 0,
   0x044F, 0x00E2, 0,
   0x0451, 0x00EB, 0,
   0x0452, 0x0111, 0,
   0x0453, 0x01F5, 0,
   0x0454, 0x00EA, 0,
   0x0455, 0x1E91, 0,
   0x0456, 0x00EC, 0,
   0x0457, 0x00EF, 0,
   0x0458, 0x01F0, 0,
   0x0459, 'l', 0x0302, 0,
   0x045A, 'n', 0x0302, 0,
   0x045B, 0x0107, 0,
   0x045C, 0x1E31, 0,
   0x045E, 0x016D, 0,
   0x045F, 'd', 0x0302,
   0x0462, 0x011A, 0,
   0x0463, 0x011B, 0,
   0x046A, 0x01CD, 0,
   0x046B, 0x01CE, 0,
   0x0472, 'F', 0x0300, 0,
   0x0473, 'f', 0x0300, 0,
   0x0474, 0x1EF2, 0,
   0x0475, 0x1EF3, 0,
   0x0490, 'G', 0x0300, 0,
   0x0491, 'g', 0x0300, 0,
   0x0492, 0x0120, 0,
   0x0493, 0x0121, 0,
   0x0494, 0x011E, 0,
   0x0495, 0x011F, 0,
   0x049A, 0x0136, 0,
   0x049B, 0x0137, 0,
   0x049C, 'K', 0x0302, 0,
   0x049D, 'k', 0x0302, 0,
   0x049E, 'K', 0x0304, 0,
   0x049F, 'k', 0x0304, 0,
   0x04A0, 0x01E8, 0,
   0x04A1, 0x01E9, 0,
   0x04A2, 0x0145, 0,
   0x04A3, 0x0146, 0,
   0x04A4, 0x1E44, 0,
   0x04A5, 0x1E45, 0,
   0x04A6, 0x1E54, 0,
   0x04A7, 0x1E55, 0,
   0x04A8, 0x00D2, 0,
   0x04A9, 0x00F2, 0,
   0x04AA, 0x015E, 0,
   0x04AB, 0x015F, 0,
   0x04AC, 0x0162, 0,
   0x04AD, 0x0163, 0,
   0x04AE, 0x00D9, 0,
   0x04AF, 0x00F9, 0,
   0x04B0, 'U', 0x0307, 0,
   0x04B1, 'u', 0x0307, 0,
   0x04B2, 0x1E28, 0,
   0x04B3, 0x1E29, 0,
   0x04B4, 'C', 0x0304, 0,
   0x04B5, 'c', 0x0304, 0,
   0x04B6, 0x00C7, 0,
   0x04B7, 0x00E7, 0,
   0x04B8, 0x0108, 0,
   0x04B9, 0x0109, 0,
   0x04BA, 0x1E24, 0,
   0x04BB, 0x1E25, 0,
   0x04BC, 'C', 0x0306, 0,
   0x04BD, 'c', 0x0306, 0,
   0x04BE, 0x00C7, 0x0306, 0,
   0x04BF, 0x00E7, 0x0306, 0,
   0x04C0, 0x2021, 0,
   0x04C1, 'Z', 0x0306, 0,
   0x04C2, 'z', 0x0306, 0,
   0x04C3, 0x1E32, 0,
   0x04C4, 0x1E33, 0,
   0x04C5, 0x013B, 0,
   0x04C6, 0x013C, 0,
   0x04C7, 0x0143, 0,
   0x04C8, 0x0144, 0,
   0x04C9, 0x1E46, 0,
   0x04CA, 0x1E47, 0,
   0x04CB, 'C', 0x0323, 0,
   0x04CC, 'c', 0x0323, 0,
   0x04D0, 0x0102, 0,
   0x04D1, 0x0103, 0,
   0x04D2, 0x00C4, 0,
   0x04D3, 0x00E4, 0,
   0x04D4, 0x00C6, 0,
   0x04D5, 0x00E6, 0,
   0x04D6, 0x0114, 0,
   0x04D7, 0x0115, 0,
   0x04D8, 'A', 0x030B, 0,
   0x04D9, 'a', 0x030B, 0,
   0x04DA, 0x00C0, 0,
   0x04DB, 0x00E0, 0,
   0x04DC, 'Z', 0x0304, 0,
   0x04DD, 'z', 0x0304, 0,
   0x04DE, 'Z', 0x0308, 0,
   0x04DF, 'z', 0x0308, 0,
   0x04E0, 0x0179, 0,
   0x04E1, 0x017A, 0,
   0x04E2, 0x012A, 0,
   0x04E3, 0x012B, 0,
   0x04E4, 0x00CE, 0,
   0x04E5, 0x00EE, 0,
   0x04E6, 0x00D6, 0,
   0x04E7, 0x00F6, 0,
   0x04E8, 0x00D4, 0,
   0x04E9, 0x00F4, 0,
   0x04EA, 0x0150, 0,
   0x04EB, 0x0151, 0,
   0x04EE, 0x016A, 0,
   0x04EF, 0x016B, 0,
   0x04F0, 0x00DC, 0,
   0x04F1, 0x00FC, 0,
   0x04F2, 0x0170, 0,
   0x04F3, 0x0171, 0,
   0x04F4, 'C', 0x0308, 0,
   0x04F5, 'c', 0x0308, 0,
   0x04F8, 0x0178, 0,
   0x04F9, 0x00FF, 0,
   0x050A, 0x01F8, 0,
   0x050B, 0x01F9, 0,
   0x050E, 'T', 0x0300, 0,
   0x050F, 't', 0x0300, 0,
   0x051A, 'Q', 0,
   0x051B, 'q', 0,
   0x051C, 'W', 0,
   0x051D, 'w', 0,
   // Armenian
   0x0531, 'A', 0,
   0x0532, 'B', 0,
   0x0533, 'G', 0,
   0x0534, 'D', 0,
   0x0535, 'E', 0,
   0x0536, 'Z', 0,
   0x0537, 0x0112, 0,
   0x0538, 0x00CB, 0,
   0x0539, 'T', '\'', 0,
   0x053A, 'Z', 'H', 0,
   0x053B, 'I', 0,
   0x053C, 'L', 0,
   0x053D, 'X', 0,
   0x053E, 0x00C7, 0,
   0x053F, 'K', 0,
   0x0540, 'H', 0,
   0x0541, 'J', 0,
   0x0542, 'G', 'H', 0,
   0x0543, 0x010C, 0,
   0x0544, 'M', 0,
   0x0545, 'Y', 0,
   0x0546, 'N', 0,
   0x0547, 0x0160, 0,
   0x0548, 'O', 0,
   0x0549, 0x010C, 0,
   0x054A, 'P', 0,
   0x054B, 0x01F0, 0,
   0x054C, 'R', 'R', 0,
   0x054D, 'S', 0,
   0x054E, 'V', 0,
   0x054F, 'T', 0,
   0x0550, 'R', 0,
   0x0551, 'C', '\'', 0,
   0x0552, 'W', 0,
   0x0553, 'P', '\'', 0,
   0x0554, 'K', '\'', 0,
   0x0555, 0x00D2, 0,
   0x0556, 'F', 0,
   0x0557, 'E', 'W', 0,
   0x0561, 'a', 0,
   0x0562, 'b', 0,
   0x0563, 'g', 0,
   0x0564, 'd', 0,
   0x0565, 'e', 0,
   0x0566, 'z', 0,
   0x0567, 0x0113, 0,
   0x0568, 0x00EB, 0,
   0x0569, 't', '\'', 0,
   0x056A, 'z', 'h', 0,
   0x056B, 'i', 0,
   0x056C, 'l', 0,
   0x056D, 'x', 0,
   0x056E, 0x00E7, 0,
   0x056F, 'k', 0,
   0x0570, 'h', 0,
   0x0571, 'j', 0,
   0x0572, 'g', 'h', 0,
   0x0573, 0x010D, 0,
   0x0574, 'm', 0,
   0x0575, 'y', 0,
   0x0576, 'n', 0,
   0x0577, 's', 'h', 0,
   0x0578, 'o', 0,
   0x0579, 'c', 'h', 0,
   0x057A, 'p', 0,
   0x057B, 'j', 0,
   0x057C, 'r', 'r', 0,
   0x057D, 's', 0,
   0x057E, 'v', 0,
   0x057F, 't', 0,
   0x0580, 'r', 0,
   0x0581, 'c', '\'', 0,
   0x0582, 'w', 0,
   0x0583, 'p', '\'', 0,
   0x0584, 'k', '\'', 0,
   0x0585, 0x00F2, 0,
   0x0586, 'f', 0,
   0x0587, 'e', 'w', 0,
   // Hebrew
   0x05B1, 'e', 0,
   // Arabic
   0x0621, 0x02CC, 0,
   // Syriac
   0x0710, '\'', 0,
   // Arabic Supplement from 0x0750-0x077F)
   // Thaana from 0x0780-0x07BF
   // NKo / Mande
   0x07C0, '0', 0,
   // Samaritan from 0x0800-0x083F
   // Mandiac from 0x0840-0x085F
   // Syriac Supplement from 0x0860-0x086F
   // Arabic Extended from 0x08A0-0x08FF
   // Devanagari
   0x0901, 'm', 0x0310, 0,
   // Bengali / Assamese from 0x980-0x09FF    TODO
   0x0985, 'a', 0,
   // Gurmuki from 0x0A00-0x0A7F
   // Gujarati from 0x0A80-0x0AFF    TODO
   // Oriya from 0x0B00-0x0B7F       TODO
   // Tamil from 0x0B80-0x0BFF       TODO
   // Telugu from 0x0C00-0x0C7F      TODO
   // Kannada from 0x0C80-0x0CFF     TODO
   // Malayalam from 0x0D00-0x0D7F   TODO
   // Sinhala from 0x0D80-0x0DFF     TODO
   // Thai (ISO 11940) from 0x0E00-0x0E7F
   0x0E01, 'k', 0,
   // Lao from 0x0E80-0x0EFF         TODO
   // Tibetan from 0x0F00-0x0FFF     TODO
   // Myanmar from 0x1000-0x109F
   // Georgian (ISO 9984) from 0x10A0-0x10FF
   0x10D0, 'a', 0,
   // Hangul Jamo from 0x1100-0x11FF TODO
   // Ethiopic (Amharic) from 0x1200-0x137F  TODO
   0x1200, 'h', 'a', 0,
   0x137B, '1', '0', '0', 0,
   0x137C, '1', '0', '0', '0', 0,
   // Ethiopic Supplement from 0x1380-0x139F
   // Cherokee from 0x13A0-0x13FF
   0x13A0,  'a', 0,
   // Unified Canadian Aboriginal Syllabics from 0x1400-0x167F
   // Ogham from 0x1680-0x169F
   // Runic from 0x16A0-0x16FF
   // Tagalog from 0x1700-0x171F
   // Hanunoo from 0x1720-0x173F
   // Buhi from 0x1740-0x175F
   // Tagbanwa from 0x1760-0x17FF
   // Khmer from 0x1780-0x17FF       TODO
   // Mongolian from 0x1800-0x18AF   TODO
   // Unified Canadian Aboriginal Syllabics Extended from 0x18B0-0x18FF
   // Limbu from 0x1900-0x194F       TODO
   // Tai Le from 0x1950-0x197F
   // New Tai Lue from 0x1980-0x19DF
   // Khmer symbols from 0x19E0-0x19FF
   // Buginese from 0x1A00-0x1A1F
   // Tai Tham from 0x1A20-0x1AAF
   // combining diacritical marks from 0x1AB0-0x1AFF
   // Balinese from 0x1B00-01B7F     TODO
   // Sundanese from 0x1B80-0x1BBF
   // Batak from 0x1BC0-0x1BFF       TODO
   // Lepcha from 0x1C00-0x1C4F      TODO
   // Ol Chiki from 0x1C50-0x1C7F    TODO
   0x1C50, '0', 0,
   // Cyrillic Extended-C from 0x1C80-0x1C8F
   // Georgian Extended form 0x1C90-0x1CBF
   // Sundanese Supplement from 0x1CC0-0x1CCF
   // Vedic Extensions from 0x1CD0-0x1CFF
   // Phonetic Extensions from 0x1D00-0x1DBF
   // combining diacritic marks supplement from 0x1DC0-0x1DFF
   // Latin Extended Additional from 0x1E00-0x1EFF
   // Extended Greek (like ISO 843 ignoring diacritics) from 0x1F00-0x1FFF
   0x1FFC, 0x014C, 0,
   0x1FFD, '\'', 0,
   0x1FFE, '`', 0,
   // Bopomofo (Chinese phonetic alphabet), from CLDR 32
   0x3105, 'b', 0,
   0x3106, 'p', 0,
   0x3107, 'm', '1', 0,
   0x3108, 'f', 0,
   0x3109, 'd', 0,
   0x310A, 't', 0,
   0x310B, 'n', 0,   // should actually be 'n1', an additional combining diacritic suppresses the '1'
   0x310C, 'l', 0,
   0x310D, 'g', 0,
   0x310E, 'k', 0,
   0x310F, 'h', 0,
   0x3110, 'j', 0,
   0x3111, 'q', 0,
   0x3112, 'x', 0,
   0x3113, 'z', 'h', 'i', '1', 0,
   0x3114, 'c', 'h', 'i', '1', 0,
   0x3115, 's', 'h', 'i', '1', 0,
   0x3116, 'r', 'i', '1', 0,
   0x3117, 'z', 'i', '1', 0,
   0x3118, 'c', 'i', '1', 0,
   0x3119, 's', 'i', '1', 0,
   0x311A, 'a', 0,	// should actually be 'a1',an additional combining diacritic suppresses the '1'
   0x311B, 'o', 0,	// should actually be 'o1',an additional combining diacritic suppresses the '1'
   0x311C, 'e', 0,	// should actually be 'e1',an additional combining diacritic suppresses the '1'
   0x311D, 'e', 'h', '1', 0,
   0x311E, 'a', 'i', '1', 0,
   0x311F, 'e', 'i', '1', 0,
   0x3120, 'a', 'o', '1', 0,
   0x3121, 'o', 'u', '1', 0,
   0x3122, 'a', 'n', '1', 0,
   0x3123, 'e', 'n', '1', 0,
   0x3124, 'a', 'n', 'g', '1', 0,
   0x3125, 'e', 'n', 'g', '1', 0,
   0x3126, 'e', 'r', '1', 0,
   0x3127, 'y', 'i', 0,   // should actually be 'yi1',an additional combining diacritic suppresses the '1'
   0x3128, 'w', 'u', 0,   // should actually be 'wu1',an additional combining diacritic suppresses the '1'
   0x3129, 'y', 'u', '1', 0 ,
   // end Bopomofo
   } ;
   
/************************************************************************/
/*	Static Members for class Romanizer				*/
/************************************************************************/

uint16_t Romanizer::s_mapping[] ;

/************************************************************************/
/*	Methods for class Romanizer					*/
/************************************************************************/

unsigned Romanizer::utf8codepoint(const char *buf, wchar_t &codepoint)
{
   int len = 0 ;
   codepoint = 0 ;
   if (buf)
      {
      unsigned cp = ((unsigned char*)buf)[0] ;
      if ((cp & 0x80) == 0)
	 {
	 codepoint = cp ;
	 return 1 ;
	 }
      else if ((cp & 0xE0) == 0xC0)
	 {
	 len = 2 ;
	 cp &= 0x1F ;
	 }
      else if ((cp & 0xF0) == 0xE0)
	 {
	 len = 3 ;
	 cp &= 0x0F ;
	 }
      else if ((cp & 0xF8) == 0xF0)
	 {
	 len = 4 ;
	 cp &= 0x07 ;
	 }
      else if ((cp & 0xFC) == 0xF8)
	 {
	 len = 5 ;
	 cp &= 0x03 ;
	 }
      else if ((cp & 0xFE) == 0xFC)
	 {
	 len = 6 ;
	 cp &= 0x01 ;
	 }
      else
	 {
	 // high bits are 10, which is a continuation byte and invalid at
	 //   this point
	 codepoint = 0xFFFF ;
	 return 0 ;
	 }
      for (int i = 1 ; i < len ; i++)
	 {
	 if ((buf[i] & 0xC0) != 0x80)
	    {
	    codepoint = 0xFFFF ;
	    return 0 ; // invalid byte sequence
	    }
	 cp = (cp << 6) | (buf[i] & 0x3F) ;
	 }
      codepoint = cp ;
      }
   return len ;
}

//----------------------------------------------------------------------

bool Romanizer::romanizable(wchar_t codepoint)
{
   return (unsigned)codepoint < lengthof(s_mapping) && s_mapping[codepoint] != 0 ;
}

//----------------------------------------------------------------------

int Romanizer::romanize(wchar_t codepoint, char *buffer)
{
   bool byteswap = false ;
   if (romanizable(codepoint))
      {
      int bytes = 0 ;
      for (uint16_t index = s_mapping[codepoint] ; cp_table[index] ; ++index)
      while (cp_table[index])
	 {
	 bytes += Fr::Unicode_to_UTF8(cp_table[index++],buffer+bytes,byteswap) ;
	 }
      return bytes ;
      }
   else
      {
      return Fr::Unicode_to_UTF8(codepoint,buffer,byteswap) ;
      }
}

//----------------------------------------------------------------------

unsigned Romanizer::romanize(wchar_t codepoint, wchar_t &romanized1, wchar_t &romanized2)
{
   if (romanizable(codepoint))
      {
      uint16_t index = s_mapping[codepoint] ;
      romanized1 = cp_table[index] ;
      romanized2 = cp_table[index+1] ;
      return romanized2 ? 2 : 1 ;
      }
   else
      {
      romanized1 = codepoint ;
      }
   return 1 ;
}

//----------------------------------------------------------------------

void Romanizer::StaticInitialization()
{
   uint16_t offset = 0 ;
   while (offset <  lengthof(cp_table))
      {
      uint16_t cp = cp_table[offset++] ;
      if (cp < lengthof(s_mapping))
	 s_mapping[cp] = offset ;
      // scan for the terminating zero codepoint
      while (offset < lengthof(cp_table) && cp_table[offset])
	 {
	 ++offset ;
	 }
      // skip the terminating zero codepoint
      ++offset ;
      }
   return ;
}

//----------------------------------------------------------------------

} // end namespace Fr

// end of file romanizer.C //
